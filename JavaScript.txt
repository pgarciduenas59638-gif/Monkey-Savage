class PasswordGenerator {
    constructor() {
        this.elements = {
            passwordOutput: document.getElementById('passwordOutput'),
            copyBtn: document.getElementById('copyBtn'),
            generateBtn: document.getElementById('generateBtn'),
            length: document.getElementById('length'),
            uppercase: document.getElementById('uppercase'),
            lowercase: document.getElementById('lowercase'),
            numbers: document.getElementById('numbers'),
            symbols: document.getElementById('symbols'),
            strengthBar: document.getElementById('strengthBar')
        };

        this.characters = {
            uppercase: 'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
            lowercase: 'abcdefghijklmnopqrstuvwxyz',
            numbers: '0123456789',
            symbols: '!@#$%^&*()_+-=[]{}|;:,.<>?'
        };

        this.init();
    }

    init() {
        this.elements.generateBtn.addEventListener('click', () => this.generatePassword());
        this.elements.copyBtn.addEventListener('click', () => this.copyToClipboard());
        
        // Generar contrase√±a al cargar
        this.generatePassword();
    }

    generatePassword() {
        const length = parseInt(this.elements.length.value);
        const options = {
            uppercase: this.elements.uppercase.checked,
            lowercase: this.elements.lowercase.checked,
            numbers: this.elements.numbers.checked,
            symbols: this.elements.symbols.checked
        };

        // Validar que al menos una opci√≥n est√© seleccionada
        if (!Object.values(options).some(opt => opt)) {
            alert('‚ö†Ô∏è Debes seleccionar al menos un tipo de car√°cter');
            return;
        }

        let charset = '';
        let password = '';

        // Construir el conjunto de caracteres
        for (const [key, value] of Object.entries(options)) {
            if (value) charset += this.characters[key];
        }

        // Generar contrase√±a aleatoria
        for (let i = 0; i < length; i++) {
            password += charset.charAt(Math.floor(Math.random() * charset.length));
        }

        this.elements.passwordOutput.value = password;
        this.updateStrengthIndicator(password, options);
    }

    updateStrengthIndicator(password, options) {
        const bar = this.elements.strengthBar;
        bar.className = 'strength-bar';
        
        let score = 0;
        const length = password.length;
        
        // Puntuaci√≥n por longitud
        if (length >= 8) score += 1;
        if (length >= 12) score += 1;
        if (length >= 16) score += 1;
        
        // Puntuaci√≥n por variedad de caracteres
        score += Object.values(options).filter(Boolean).length;
        
        // Puntuaci√≥n por combinaci√≥n de tipos
        if (options.uppercase && options.lowercase) score += 1;
        if (options.numbers && options.symbols) score += 1;

        // Actualizar visualizaci√≥n
        if (score <= 3) {
            bar.classList.add('weak');
        } else if (score <= 5) {
            bar.classList.add('medium');
        } else {
            bar.classList.add('strong');
        }
    }

    async copyToClipboard() {
        const password = this.elements.passwordOutput.value;
        
        if (!password) {
            alert('No hay contrase√±a para copiar');
            return;
        }

        try {
            await navigator.clipboard.writeText(password);
            
            // Feedback visual
            this.elements.copyBtn.classList.add('copied');
            this.elements.copyBtn.textContent = '‚úÖ';
            this.elements.copyBtn.style.background = '#48bb78';
            
            setTimeout(() => {
                this.elements.copyBtn.classList.remove('copied');
                this.elements.copyBtn.textContent = 'üìã';
                this.elements.copyBtn.style.background = '#667eea';
            }, 2000);
            
        } catch (err) {
            alert('Error al copiar: ' + err.message);
        }
    }
}

// Inicializar al cargar
document.addEventListener('DOMContentLoaded', () => {
    new PasswordGenerator();
});